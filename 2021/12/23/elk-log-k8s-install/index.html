<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="elasticsearch作为搜索的标配，有着很多的使用场景。 之前有搭建过单机版的elasticsearch，现在搭建集群版本的elasticsearch"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>ELK日志系统K8S部署 | linkpwd|</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">主页</a><a class="sidebar-nav-item" href="/archives">归档</a></nav><div class="container post-meta"><div class="post-time">2021-12-23</div></div></div><div class="container post-header"><h1>ELK日志系统K8S部署</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">目录</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#elasticsearch%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.</span> <span class="toc-text">elasticsearch服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#elasticsearch-yaml%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.</span> <span class="toc-text">elasticsearch yaml文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#elasticsearch-yaml-config%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-number">1.2.</span> <span class="toc-text">elasticsearch.yaml  config配置文件：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E6%8C%89%E7%B1%BB%E5%9E%8B%E6%9D%A5%E9%83%A8%E7%BD%B2%E7%9A%84%E8%AF%9D%EF%BC%8C%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%9C%89%E4%BA%9B%E8%AE%B8%E5%8C%BA%E5%88%AB"><span class="toc-number">1.3.</span> <span class="toc-text">如果按类型来部署的话，配置文件有些许区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#elasticsearch-jvm%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-number">1.4.</span> <span class="toc-text">elasticsearch-jvm配置文件：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#es-keystore-%E5%AF%86%E9%92%A5%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-number">1.5.</span> <span class="toc-text">es-keystore 密钥文件：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kibana%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">kibana配置：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#logstash%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">3.</span> <span class="toc-text">logstash配置：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#heartbeat-URL%E7%9B%91%E6%8E%A7%EF%BC%9A"><span class="toc-number">4.</span> <span class="toc-text">heartbeat URL监控：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">过程中问题处理</span></a></li></ol></details></div><div class="container post-content"><p>elasticsearch作为搜索的标配，有着很多的使用场景。 之前有搭建过单机版的elasticsearch，现在搭建集群版本的elasticsearch</p>
<h3 id="elasticsearch服务"><a href="#elasticsearch服务" class="headerlink" title="elasticsearch服务"></a>elasticsearch服务</h3><p>此处不区分elaticsearch data, mater, ingest,如区分的话需要分别创建这几个类型相应的集群，另配置的内存大小等均自行相应设置</p>
<h4 id="elasticsearch-yaml文件"><a href="#elasticsearch-yaml文件" class="headerlink" title="elasticsearch yaml文件"></a>elasticsearch yaml文件</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 此处遇到了几个问题，</span></span><br><span class="line"><span class="comment">## 1： volumeClaimTemplates，让其自动创建nas的问题，需要StorageClass的设置 https://help.aliyun.com/document_detail/144398.html</span></span><br><span class="line"><span class="comment">## 2:  elasticsearch.yml配置问题 discovery.seed_hosts  cluster.initial_master_nodes 集群仍503，有问题</span></span><br><span class="line"><span class="comment">## 3:  nas并未挂载到集群中，与老的1.11版本的k8s不一致，需要mountPath类型不能为empty，需要写上名称。 还说重启完之类密码怎么变了呢？</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">elasticsearch</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">elasticsearch</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">elastic</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">podManagementPolicy:</span> <span class="string">OrderedReady</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">elasticsearch</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">elasticsearch</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">redeploy-timestamp:</span> <span class="string">&#x27;1640165941583&#x27;</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">elasticsearch</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_IP</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">status.podIP</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ES_JAVA_OPTS</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;-Xms14g -Xmx14g&#x27;</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">&#x27;elasticsearch:7.10.1&#x27;</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">elasticsearch-data</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9200</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9300</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">transport</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">&#x27;4&#x27;</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">16Gi</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">&#x27;4&#x27;</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">14Gi</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">capabilities:</span></span><br><span class="line">              <span class="attr">add:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">IPC_LOCK</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">SYS_RESOURCE</span></span><br><span class="line">            <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">terminationMessagePath:</span> <span class="string">/dev/termination-log</span></span><br><span class="line">          <span class="attr">terminationMessagePolicy:</span> <span class="string">File</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/usr/share/elasticsearch/config/elasticsearch.yml</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">volume-1640071534570</span></span><br><span class="line">              <span class="attr">subPath:</span> <span class="string">elasticsearch.yml</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/usr/share/elasticsearch/config/elastic-certificates.p12</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">volume-1640071564578</span></span><br><span class="line">              <span class="attr">subPath:</span> <span class="string">elastic-certificates.p12</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/usr/share/elasticsearch/data</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">elasticsearch</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/usr/share/elasticsearch/config/jvm.options</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">volume-1640159109924</span></span><br><span class="line">              <span class="attr">subPath:</span> <span class="string">jvm.options</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">command:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/sbin/sysctl</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;-w&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">vm.max_map_count=262144</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">&#x27;alpine:3.9&#x27;</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">elasticsearch-init</span></span><br><span class="line">          <span class="attr">resources:</span> &#123;&#125;</span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">terminationMessagePath:</span> <span class="string">/dev/termination-log</span></span><br><span class="line">          <span class="attr">terminationMessagePolicy:</span> <span class="string">File</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">d</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">schedulerName:</span> <span class="string">default-scheduler</span></span><br><span class="line">      <span class="attr">securityContext:</span></span><br><span class="line">        <span class="attr">fsGroup:</span> <span class="number">1000</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">elasticsearch-config</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">volume-1640071534570</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">volume-1640071564578</span></span><br><span class="line">          <span class="attr">secret:</span></span><br><span class="line">            <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">            <span class="attr">secretName:</span> <span class="string">es-keystore</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">emptyDir:</span> &#123;&#125;</span><br><span class="line">          <span class="attr">name:</span> <span class="string">volume-1640071578299</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">elasticsearch-jvm</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">volume-1640159109924</span></span><br><span class="line">  <span class="attr">updateStrategy:</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">partition:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">      <span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line">      <span class="attr">metadata:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">elasticsearch</span></span><br><span class="line">      <span class="attr">spec:</span></span><br><span class="line">        <span class="attr">accessModes:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">storage:</span> <span class="string">500Gi</span></span><br><span class="line">        <span class="attr">storageClassName:</span> <span class="string">elasticsearch</span></span><br><span class="line">        <span class="attr">volumeMode:</span> <span class="string">Filesystem</span></span><br><span class="line">      <span class="attr">status:</span></span><br><span class="line">        <span class="attr">phase:</span> <span class="string">Pending</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="elasticsearch-yaml-config配置文件："><a href="#elasticsearch-yaml-config配置文件：" class="headerlink" title="elasticsearch.yaml  config配置文件："></a>elasticsearch.yaml  config配置文件：</h4><p>此种特别注意node.master, node.ingest, node.data,最开始集群状态不正常，不能修改密码，以及discovery.seed_hosts, cluster.initial_master_nodes 参数，最后加上xpack安全密码的</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cluster.name:</span> <span class="string">&quot;elasticsearch&quot;</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">$&#123;POD_NAME&#125;.elasticsearch.elastic.svc.cluster.local</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="attr">transport.tcp.port:</span> <span class="number">9300</span></span><br><span class="line"></span><br><span class="line"><span class="attr">node.master:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">node.ingest:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">bootstrap.memory_lock:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">discovery.seed_hosts:</span> [<span class="string">&quot;elasticsearch-0.elasticsearch.elastic.svc.cluster.local&quot;</span>,<span class="string">&quot;elasticsearch-1.elasticsearch.elastic.svc.cluster.local&quot;</span>,<span class="string">&quot;elasticsearch-2.elasticsearch.elastic.svc.cluster.local&quot;</span>]</span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span>  [<span class="string">&quot;elasticsearch-0.elasticsearch.elastic.svc.cluster.local&quot;</span>,<span class="string">&quot;elasticsearch-1.elasticsearch.elastic.svc.cluster.local&quot;</span>,<span class="string">&quot;elasticsearch-2.elasticsearch.elastic.svc.cluster.local&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># xpack.security.enabled: false</span></span><br><span class="line"><span class="attr">xpack.security.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">xpack.security.transport.ssl.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">xpack.security.transport.ssl.verification_mode:</span> <span class="string">&quot;certificate&quot;</span></span><br><span class="line"><span class="attr">xpack.security.transport.ssl.keystore.path:</span> <span class="string">&quot;/usr/share/elasticsearch/config/elastic-certificates.p12&quot;</span></span><br><span class="line"><span class="attr">xpack.security.transport.ssl.truststore.path:</span> <span class="string">&quot;/usr/share/elasticsearch/config/elastic-certificates.p12&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="如果按类型来部署的话，配置文件有些许区别"><a href="#如果按类型来部署的话，配置文件有些许区别" class="headerlink" title="如果按类型来部署的话，配置文件有些许区别"></a>如果按类型来部署的话，配置文件有些许区别</h4><p>ingress : </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">node.master:</span> <span class="literal">false</span> </span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">false</span> </span><br><span class="line"><span class="attr">node.ingest:</span> <span class="literal">true</span> </span><br></pre></td></tr></table></figure>


<p>data</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">node.master:</span> <span class="literal">false</span> </span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">node.ingest:</span> <span class="literal">false</span> </span><br></pre></td></tr></table></figure>

<p>master</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">node.master:</span> <span class="literal">true</span> </span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">false</span> </span><br><span class="line"><span class="attr">node.ingest:</span> <span class="literal">false</span> </span><br></pre></td></tr></table></figure>


<h4 id="elasticsearch-jvm配置文件："><a href="#elasticsearch-jvm配置文件：" class="headerlink" title="elasticsearch-jvm配置文件："></a>elasticsearch-jvm配置文件：</h4><p>由于在ES_JAVA_OPTS中写入了-Xms -Xmx，启动时也有默认的1g的，所以这个配置文件也从jvm去读了</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">8</span><span class="number">-13</span><span class="string">:-XX:+UseConcMarkSweepGC</span></span><br><span class="line"><span class="number">8</span><span class="number">-13</span><span class="string">:-XX:CMSInitiatingOccupancyFraction=75</span></span><br><span class="line"><span class="number">8</span><span class="number">-13</span><span class="string">:-XX:+UseCMSInitiatingOccupancyOnly</span></span><br><span class="line"></span><br><span class="line"><span class="number">14</span><span class="string">-:-XX:+UseG1GC</span></span><br><span class="line"><span class="number">14</span><span class="string">-:-XX:G1ReservePercent=25</span></span><br><span class="line"><span class="number">14</span><span class="string">-:-XX:InitiatingHeapOccupancyPercent=30</span></span><br><span class="line"></span><br><span class="line"><span class="string">-Djava.io.tmpdir=$&#123;ES_TMPDIR&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">-XX:+HeapDumpOnOutOfMemoryError</span></span><br><span class="line"></span><br><span class="line"><span class="string">-XX:HeapDumpPath=data</span></span><br><span class="line"></span><br><span class="line"><span class="string">-XX:ErrorFile=logs/hs_err_pid%p.log</span></span><br><span class="line"></span><br><span class="line"><span class="number">8</span><span class="string">:-XX:+PrintGCDetails</span></span><br><span class="line"><span class="number">8</span><span class="string">:-XX:+PrintGCDateStamps</span></span><br><span class="line"><span class="number">8</span><span class="string">:-XX:+PrintTenuringDistribution</span></span><br><span class="line"><span class="number">8</span><span class="string">:-XX:+PrintGCApplicationStoppedTime</span></span><br><span class="line"><span class="number">8</span><span class="string">:-Xloggc:logs/gc.log</span></span><br><span class="line"><span class="number">8</span><span class="string">:-XX:+UseGCLogFileRotation</span></span><br><span class="line"><span class="number">8</span><span class="string">:-XX:NumberOfGCLogFiles=32</span></span><br><span class="line"><span class="number">8</span><span class="string">:-XX:GCLogFileSize=64m</span></span><br><span class="line"></span><br><span class="line"><span class="number">9</span><span class="string">-:-Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m</span></span><br></pre></td></tr></table></figure>

<h4 id="es-keystore-密钥文件："><a href="#es-keystore-密钥文件：" class="headerlink" title="es-keystore 密钥文件："></a>es-keystore 密钥文件：</h4><p>用于加密的需要这个配置文件</p>
<h3 id="kibana配置："><a href="#kibana配置：" class="headerlink" title="kibana配置："></a>kibana配置：</h3><ol>
<li><p> 较为简单，配置文件，启动deployment</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server.name: kibana</span><br><span class="line">server.port: 5601</span><br><span class="line">server.host: &quot;0.0.0.0&quot;</span><br><span class="line">elasticsearch.hosts: &quot;http://elasticsearch:9200&quot;</span><br><span class="line">xpack.monitoring.ui.container.elasticsearch.enabled: true</span><br><span class="line">elasticsearch.username: kibana</span><br><span class="line">elasticsearch.password: mypassword</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>ingress加个 nginx.ingress.kubernetes.io/whitelist-source-range </p>
</li>
<li><p>密码使用elasticsearch创建的密码，可以使用elastic等帐号</p>
</li>
</ol>
<h3 id="logstash配置："><a href="#logstash配置：" class="headerlink" title="logstash配置："></a>logstash配置：</h3><ol>
<li><p>logstash.yaml配置文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">logstash</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">logstash</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">elastic</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">progressDeadlineSeconds:</span> <span class="number">600</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">logstash</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">25</span><span class="string">%</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">25</span><span class="string">%</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">redeploy-timestamp:</span> <span class="string">&#x27;1639469723595&#x27;</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">logstash</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">nodeAffinity:</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">            <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">matchExpressions:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">group</span></span><br><span class="line">                    <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                    <span class="attr">values:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">d</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">XPACK_MONITORING_ENABLED</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">xpack.monitoring.elasticsearch.hosts</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;http://elasticsearch:9200&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">xpack.monitoring.elasticsearch.username</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">elastic</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">xpack.monitoring.elasticsearch.password</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">mypassword</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pipeline.workers</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;6&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pipeline.batch.size</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;4000&#x27;</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">&#x27;elastic/logstash:7.10.1&#x27;</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">logstash</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">5Gi</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">4Gi</span></span><br><span class="line">          <span class="attr">terminationMessagePath:</span> <span class="string">/dev/termination-log</span></span><br><span class="line">          <span class="attr">terminationMessagePolicy:</span> <span class="string">File</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/usr/share/logstash/pipeline/</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">volume-1640225693496</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/usr/share/logstash/config/jvm.options</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">volume-1640234037039</span></span><br><span class="line">              <span class="attr">subPath:</span> <span class="string">jvm.options</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">schedulerName:</span> <span class="string">default-scheduler</span></span><br><span class="line">      <span class="attr">securityContext:</span></span><br><span class="line">        <span class="attr">fsGroup:</span> <span class="number">1000</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">devops</span></span><br><span class="line">          <span class="attr">operator:</span> <span class="string">Equal</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">run</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">logstash-pipeline-config</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">volume-1640225693496</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">logstash-jvm</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">volume-1640234037039</span></span><br></pre></td></tr></table></figure></li>
<li><p>对应的配置文件：<br>logstash.yml  </p>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">xpack.monitoring.elasticsearch.hosts:</span> <span class="string">http://elasticsearch:9200</span></span><br><span class="line"><span class="attr">xpack.monitoring.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">xpack.monitoring.elasticsearch.username:</span> <span class="string">&quot;elastic&quot;</span> </span><br><span class="line"><span class="attr">xpack.monitoring.elasticsearch.password:</span> <span class="string">&quot;mypassword&quot;</span></span><br><span class="line"><span class="string">```</span>  </span><br><span class="line"></span><br><span class="line"><span class="string">pipeline文件</span> <span class="attr">logstash.conf:</span></span><br><span class="line"><span class="string">```yaml</span></span><br><span class="line"><span class="string">input</span> &#123;</span><br><span class="line">  <span class="string">redis</span> &#123;</span><br><span class="line">    <span class="string">host</span> <span class="string">=&gt;</span> <span class="string">&quot;r-bp1d17217fa77e14756.redis.rds.aliyuncs.com&quot;</span></span><br><span class="line">    <span class="string">port</span> <span class="string">=&gt;</span> <span class="number">6379</span></span><br><span class="line">    <span class="string">password</span> <span class="string">=&gt;</span> <span class="string">&quot;myredis&quot;</span></span><br><span class="line">    <span class="string">data_type</span> <span class="string">=&gt;</span> <span class="string">&quot;list&quot;</span></span><br><span class="line">    <span class="string">key</span> <span class="string">=&gt;</span> <span class="string">&quot;filebeat2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">output</span> &#123;</span><br><span class="line">  <span class="string">elasticsearch</span> &#123;</span><br><span class="line">    <span class="string">hosts</span> <span class="string">=&gt;</span> [<span class="string">&quot;elasticsearch:9200&quot;</span>]</span><br><span class="line">    <span class="string">index</span> <span class="string">=&gt;</span> <span class="string">&quot;logstash-<span class="template-variable">%&#123;[fields][project]&#125;</span>-<span class="template-variable">%&#123;+YYYY-MM-dd&#125;</span>&quot;</span></span><br><span class="line">    <span class="string">user</span> <span class="string">=&gt;</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line">    <span class="string">password</span> <span class="string">=&gt;</span> <span class="string">&quot;mypassword&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="heartbeat-URL监控："><a href="#heartbeat-URL监控：" class="headerlink" title="heartbeat URL监控："></a>heartbeat URL监控：</h3><ol>
<li>较简单， 使用elastic/heartbeat:7.10.1镜像</li>
<li>配置文件 /usr/share/heartbeat/heartbeat.yml<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">heartbeat.config.monitors:</span></span><br><span class="line">  <span class="attr">reload.enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">reload.period:</span> <span class="string">60s</span></span><br><span class="line"><span class="attr">output.elasticsearch:</span></span><br><span class="line">  <span class="attr">hosts:</span> [<span class="string">&quot;elasticsearch:9200&quot;</span>]</span><br><span class="line">  <span class="attr">username:</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&quot;mypassword&quot;</span></span><br><span class="line"><span class="attr">setup.kibana:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">&quot;kibana:5601&quot;</span></span><br><span class="line"><span class="attr">heartbeat.monitors:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&#x27;官网&#x27;</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">&#x27;@every 30s&#x27;</span></span><br><span class="line">  <span class="attr">urls:</span> [<span class="string">&quot;https://www.baidu.com&quot;</span>, <span class="string">&quot;https://api.xxx.com&quot;</span>]</span><br><span class="line">  <span class="attr">check.response.status:</span> <span class="number">200</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="过程中问题处理"><a href="#过程中问题处理" class="headerlink" title="过程中问题处理"></a>过程中问题处理</h3><ol>
<li><p>设置密码报503错误, 此处应为elasticsearch配置文件写得不对; 配置文件对了的时候，可能就是帐号密码不对了； 可以先将xpack包的密码认证去掉查看集群是否正常。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./bin/elasticsearch-setup-passwords interactive</span></span><br><span class="line"></span><br><span class="line">Failed to determine the health of the cluster running at http://192.168.11.96:9200</span><br><span class="line">Unexpected response code [503] from calling GET http://192.168.11.96:9200/_cluster/health?pretty</span><br><span class="line">Cause: master_not_discovered_exception</span><br></pre></td></tr></table></figure></li>
<li><p>服务重启之后，密码不对了，原因是nas并没能挂载上去，data数据写在了empty dir了, 另外密码还是别设置不太好用的字符串如!.@之类，防不好命令行测试</p>
</li>
</ol>
<ol start="3">
<li>jvm.options文件中写了-Xms -Xmx ，如果配置文件中不注释掉的话，ES_JAVA_OPTS中注入的参数也会有，配置文件中的也会有，有两次这个参数出现</li>
</ol>
<ol start="4">
<li>一些基础的组件单独为一个资源池进行调度，打上污点，然后需要的组件进行污点容忍，就不会出现乱调度以及对应的资源情况不情楚的。如此ES我使用了4 cpu, 14g， logstash 2cpu 4g 那3台8c32g机器所剩不多了，k8s集群中request多少都有数的，什么时候加节点，加机器。</li>
</ol>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>