<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;运行环境-gitlab-gitlab-runner运行环境&quot;&gt;&lt;a href=&quot;#运行环境-gitlab-gitlab-runner运行环境&quot; class=&quot;headerlink&quot; title=&quot;运行环境 gitlab + gitlab runner运行环境&quot;&gt;&lt;/a&gt;运行环境 gitlab + gitlab runner运行环境&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;gitlab分gitlab/gitlab-ce, gitlab/gitlab-ee， 社区版本和企业版本&lt;br&gt;系统: CentOS7.9&lt;br&gt;docker: 20.10.8&lt;br&gt;gitlab版本： GitLab Community Edition 14.1.2"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>gitlab通过pipeline实现ci/cd | linkpwd|</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">主页</a><a class="sidebar-nav-item" href="/archives">归档</a></nav><div class="container post-meta"><div class="post-time">2021-09-14</div></div></div><div class="container post-header"><h1>gitlab通过pipeline实现ci/cd</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">目录</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83-gitlab-gitlab-runner%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text">运行环境 gitlab + gitlab runner运行环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gitlab%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="toc-number">2.</span> <span class="toc-text">gitlab安装部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gitlab-runner%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="toc-number">3.</span> <span class="toc-text">gitlab-runner安装配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerfile"><span class="toc-number">4.</span> <span class="toc-text">Dockerfile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gitlab-ci-yml"><span class="toc-number">5.</span> <span class="toc-text">.gitlab-ci.yml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gitlab%E5%8F%8Agitlab-runner%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">6.</span> <span class="toc-text">gitlab及gitlab-runner注意事项</span></a></li></ol></details></div><div class="container post-content"><h3 id="运行环境-gitlab-gitlab-runner运行环境"><a href="#运行环境-gitlab-gitlab-runner运行环境" class="headerlink" title="运行环境 gitlab + gitlab runner运行环境"></a>运行环境 gitlab + gitlab runner运行环境</h3><blockquote>
<p>gitlab分gitlab/gitlab-ce, gitlab/gitlab-ee， 社区版本和企业版本<br>系统: CentOS7.9<br>docker: 20.10.8<br>gitlab版本： GitLab Community Edition 14.1.2</p>
</blockquote>
<h3 id="gitlab安装部署"><a href="#gitlab安装部署" class="headerlink" title="gitlab安装部署"></a>gitlab安装部署</h3><ol>
<li><p>docker方式启动,镜像较大需要些时间, 拉取完启动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run --detach   --publish 443:443 --publish 80:80 --publish 2222:22   --name gitlab   --restart always \</span><br><span class="line">    --volume /mnt/gitlabconfig:/etc/gitlab \</span><br><span class="line">    --volume /mnt/gitlab/logs:/var/log/gitlab \</span><br><span class="line">    --volume /mnt/gitlab/data:/var/opt/gitlab  \</span><br><span class="line">    gitlab/gitlab-ce:latest</span><br></pre></td></tr></table></figure></li>
<li><p>修改部分配置(gitlab_rails时间、邮件、oss key之类均可配置)<br> external_url ‘<a target="_blank" rel="noopener" href="http://ip/&#39;">http://ip/&#39;</a> # 外网ip或域名<br> gitlab_rails[‘gitlab_ssh_host’] = ‘192.168.7.200’<br> gitlab_rails[‘gitlab_shell_ssh_port’] = 2222<br> registry_external_url ‘<a target="_blank" rel="noopener" href="https://registry-gitlab.example.com&/#39;">https://registry-gitlab.example.com&#39;</a><br> nginx[‘ssl_certificate’] = “/etc/gitlab/ssl/gitlab.example.com.pem”<br> nginx[‘ssl_certificate_key’] = “/etc/gitlab/ssl/gitlab.example.com.key”<br> prometheus_monitoring[‘enable’] = false</p>
</li>
<li><p>为保安全性，需要重置密码，网上很多说使用gitlab-rails console production，可是有报错，使用gitlab-rails console -e production，前者应该是之前的版本：<br> 运行gitlab-rails console production报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#gitlab-rails console production</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">    8: from bin/rails:4:in `&lt;main&gt;&#x27;</span><br><span class="line">    7: from bin/rails:4:in `require&#x27;</span><br><span class="line">    6: from /opt/gitlab/embedded/lib/ruby/gems/2.7.0/gems/railties-6.1.3.2/lib/rails/commands.rb:18:in `&lt;top (required)&gt;&#x27;</span><br><span class="line">    5: from /opt/gitlab/embedded/lib/ruby/gems/2.7.0/gems/railties-6.1.3.2/lib/rails/command.rb:50:in `invoke&#x27;</span><br><span class="line">    4: from /opt/gitlab/embedded/lib/ruby/gems/2.7.0/gems/railties-6.1.3.2/lib/rails/command/base.rb:69:in `perform&#x27;</span><br><span class="line">    3: from /opt/gitlab/embedded/lib/ruby/gems/2.7.0/gems/thor-1.1.0/lib/thor.rb:392:in `dispatch&#x27;</span><br><span class="line">    2: from /opt/gitlab/embedded/lib/ruby/gems/2.7.0/gems/thor-1.1.0/lib/thor/invocation.rb:127:in `invoke_command&#x27;</span><br><span class="line">    1: from /opt/gitlab/embedded/lib/ruby/gems/2.7.0/gems/thor-1.1.0/lib/thor/command.rb:27:in `run&#x27;</span><br><span class="line">/opt/gitlab/embedded/lib/ruby/gems/2.7.0/gems/railties-6.1.3.2/lib/rails/commands/console/console_command.rb:95:in `perform&#x27;: wrong number of arguments (given 1, expected 0) (ArgumentError)</span><br><span class="line">    9: from bin/rails:4:in `&lt;main&gt;&#x27;</span><br><span class="line">    8: from bin/rails:4:in `require&#x27;</span><br><span class="line">    7: from /opt/gitlab/embedded/lib/ruby/gems/2.7.0/gems/railties-6.1.3.2/lib/rails/commands.rb:18:in `&lt;top (required)&gt;&#x27;</span><br><span class="line">    6: from /opt/gitlab/embedded/lib/ruby/gems/2.7.0/gems/railties-6.1.3.2/lib/rails/command.rb:50:in `invoke&#x27;</span><br><span class="line">    5: from /opt/gitlab/embedded/lib/ruby/gems/2.7.0/gems/railties-6.1.3.2/lib/rails/command/base.rb:69:in `perform&#x27;</span><br><span class="line">    4: from /opt/gitlab/embedded/lib/ruby/gems/2.7.0/gems/thor-1.1.0/lib/thor.rb:392:in `dispatch&#x27;</span><br><span class="line">    3: from /opt/gitlab/embedded/lib/ruby/gems/2.7.0/gems/thor-1.1.0/lib/thor/invocation.rb:127:in `invoke_command&#x27;</span><br><span class="line">    2: from /opt/gitlab/embedded/lib/ruby/gems/2.7.0/gems/thor-1.1.0/lib/thor/command.rb:20:in `run&#x27;</span><br><span class="line">    1: from /opt/gitlab/embedded/lib/ruby/gems/2.7.0/gems/thor-1.1.0/lib/thor/command.rb:34:in `rescue in run&#x27;</span><br><span class="line">/opt/gitlab/embedded/lib/ruby/gems/2.7.0/gems/thor-1.1.0/lib/thor/base.rb:525:in `handle_argument_error&#x27;: ERROR: &quot;rails console&quot; was called with arguments [&quot;production&quot;] (Thor::InvocationError)</span><br><span class="line">Usage: &quot;rails console [options]&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">运行gitlab-rails console -e production</span><br><span class="line">#gitlab-rails console -e production</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Ruby:         ruby 2.7.2p137 (2020-10-01 revision 5445e04352) [x86_64-linux]</span><br><span class="line">GitLab:       14.1.2 (8c67b499146) FOSS</span><br><span class="line">GitLab Shell: 13.19.1</span><br><span class="line">PostgreSQL:   12.6</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Loading production environment (Rails 6.1.3.2)</span><br><span class="line">irb(main):001:0&gt; user=User.where(id:1).first</span><br><span class="line">=&gt; #&lt;User id:1 @root&gt;</span><br><span class="line">irb(main):002:0&gt; user.password=&#x27;mypassword&#x27;</span><br><span class="line">irb(main):002:0&gt; user.password=&#x27;mypassword&#x27;</span><br><span class="line">=&gt; &quot;mypassword&quot;</span><br><span class="line">irb(main):004:0&gt; user.password_confirmation=&#x27;mypassword&#x27;</span><br><span class="line">=&gt; &quot;mypassword&quot;</span><br><span class="line">irb(main):005:0&gt; user.save</span><br><span class="line">Enqueued ActionMailer::MailDeliveryJob (Job ID: d2188216-9afb-4b87-aa33-bbd07d8931c9) to Sidekiq(mailers) with arguments: &quot;DeviseMailer&quot;, &quot;password_change&quot;, &quot;deliver_now&quot;, &#123;:args=&gt;[#&lt;GlobalID:0x00007fd186dba088 @uri=#&lt;URI::GID gid://gitlab/User/1&gt;&gt;]&#125;</span><br><span class="line">=&gt; true</span><br></pre></td></tr></table></figure></li>
<li><p>gitlab就完成了，可以登录添加项目了。</p>
</li>
</ol>
<h3 id="gitlab-runner安装配置"><a href="#gitlab-runner安装配置" class="headerlink" title="gitlab-runner安装配置"></a>gitlab-runner安装配置</h3><p>gitlab-runner作为gitlab ci/cd的执行者，可以支持各种环境如：shell, docker，以docker为例</p>
<ol>
<li><p>启动gitlab-runner</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name gitlab-runner --restart always -v /mnt/gitlab-runner/config:/etc/gitlab-runner -v /var/run/docker.sock:/var/run/docker.sock gitlab/gitlab-runner:latest</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>注册执行器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ci-multi-runner register 或 docker exec -it gitlab-runner gitlab-ci-multi-runner register</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>config.toml配置文件(此处注意volumes的设置, build_dir）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">concurrent = 1</span><br><span class="line">check_interval = 0</span><br><span class="line"></span><br><span class="line">[session_server]</span><br><span class="line">  session_timeout = 1800</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[[runners]]</span><br><span class="line">  name = &quot;test-env&quot;</span><br><span class="line">  url = &quot;https://gitlab.example.com/&quot;</span><br><span class="line">  token = &quot;tW-N66wByFxCk&quot;</span><br><span class="line">  executor = &quot;docker&quot;</span><br><span class="line">  builds_dir = &quot;/mnt&quot;</span><br><span class="line">  [runners.custom_build_dir]</span><br><span class="line">    enabled = true</span><br><span class="line">  [runners.cache]</span><br><span class="line">    [runners.cache.s3]</span><br><span class="line">    [runners.cache.gcs]</span><br><span class="line">    [runners.cache.azure]</span><br><span class="line">  [runners.docker]</span><br><span class="line">    tls_verify = false</span><br><span class="line">    image = &quot;alpine:latest&quot;</span><br><span class="line">    privileged = false</span><br><span class="line">    disable_entrypoint_overwrite = false</span><br><span class="line">    oom_kill_disable = false</span><br><span class="line">    disable_cache = false</span><br><span class="line">    volumes = [&quot;/mnt/php-src:/mnt/php-src:rw&quot;, &quot;/var/run/docker.sock:/var/run/docker.sock&quot;, &quot;/cache&quot;, &quot;/mnt/openresty:/mnt/openresty:rw&quot;]</span><br><span class="line">    shm_size = 0</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># Version 0.1 </span><br><span class="line">FROM nginx:1.20-alpine </span><br><span class="line"></span><br><span class="line"># 复制nginx配置文件</span><br><span class="line">RUN pwd</span><br><span class="line">RUN ls -al</span><br><span class="line">COPY ./config/nginx.conf /etc/nginx/nginx.conf</span><br><span class="line">COPY ./config/default.conf /etc/nginx/conf.d/default.conf</span><br><span class="line">COPY ./config/nginx_logrotate /etc/logrotate.d/nginx_logrotate</span><br><span class="line"></span><br><span class="line"># 设置执行权限(注意权限 一定要是644)</span><br><span class="line">RUN chmod 644 /etc/logrotate.d/nginx_logrotate</span><br><span class="line"></span><br><span class="line"># 复制项目</span><br><span class="line">ADD ./dist /usr/share/nginx/html/ejy-finance-ui</span><br><span class="line"></span><br><span class="line"># 暴露端口</span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line"># 容器创建启动</span><br><span class="line">CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span><br><span class="line"></span><br><span class="line">FROM registry-vpc.cn-hangzhou.aliyuncs.com/example/alpine-oraclejdk8:slim</span><br><span class="line">ADD demo-service/target/demo-service.jar demo-service.jar</span><br><span class="line">ENTRYPOINT exec java $JAVA_OPTS -Djava.security.egd=file:/dev/./urandom -jar /demo-service.jar</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="gitlab-ci-yml"><a href="#gitlab-ci-yml" class="headerlink" title=".gitlab-ci.yml"></a>.gitlab-ci.yml</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">stages:</span><br><span class="line">  - maven-build</span><br><span class="line">  - docker-build</span><br><span class="line">  - deploy</span><br><span class="line"></span><br><span class="line">variables:</span><br><span class="line">  MAVEN_OPTS: -Dmaven.repo.local=.m2/repository</span><br><span class="line">  PROJECT_NAME: $CI_PROJECT_NAME</span><br><span class="line">  LOG_PATH_MAPPING: /mnt/logs/$CI_PROJECT_NAME:/mnt/logs/$CI_PROJECT_NAME</span><br><span class="line">  PORT_MAPPING: 9988:8080</span><br><span class="line">  DEV_IMAGE: $CI_REGISTRY/$CI_REGISTRY_NAMESPACE_DEV/$CI_PROJECT_NAME:$CI_COMMIT_SHORT_SHA-$CI_PIPELINE_ID</span><br><span class="line">  EXTDEV_IMAGE: $CI_REGISTRY/$CI_REGISTRY_NAMESPACE_DEV/ext-$CI_PROJECT_NAME:$CI_COMMIT_SHORT_SHA-$CI_PIPELINE_ID</span><br><span class="line"></span><br><span class="line">cache:</span><br><span class="line">  paths:</span><br><span class="line">    - .m2/repository/</span><br><span class="line">    - demo-service/target/</span><br><span class="line"></span><br><span class="line">maven-build:</span><br><span class="line">  stage: maven-build</span><br><span class="line">  image: registry-vpc.cn-hangzhou.aliyuncs.com/example/maven:3.6.3-jdk-8-v1</span><br><span class="line">  script:</span><br><span class="line">    - mvn clean package -Dautoconfig.skip=true -Dmaven.test.skip=true -Dmaven.test.failure.ignore=true</span><br><span class="line">  only:</span><br><span class="line">    - web</span><br><span class="line">  tags:</span><br><span class="line">    - $PROJECT_DST</span><br><span class="line"></span><br><span class="line">docker-build:</span><br><span class="line">  stage: docker-build</span><br><span class="line">  image: docker:19.03.1</span><br><span class="line">  before_script:</span><br><span class="line">    - docker login -u &quot;$CI_REGISTRY_USER&quot; -p &quot;$CI_REGISTRY_PASSWORD&quot; $CI_REGISTRY</span><br><span class="line">  script:</span><br><span class="line">    - ls -l</span><br><span class="line">    - ls -l demo-service/target</span><br><span class="line">    - docker build -t $DEV_IMAGE -f Dockerfile .</span><br><span class="line">    - docker push $DEV_IMAGE</span><br><span class="line">  only:</span><br><span class="line">    - web</span><br><span class="line">  tags:</span><br><span class="line">    - $PROJECT_DST</span><br><span class="line"></span><br><span class="line">deploy-dev:</span><br><span class="line">  stage: deploy</span><br><span class="line">  image: docker:19.03.1</span><br><span class="line">  variables:</span><br><span class="line">    JAVA_OPTS: &#x27;-Dspring.profiles.active=dev -Dserver.port=8080 -Xmx512m -Xms512m -Duser.timezone=Asia/Shanghai -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap&#x27;</span><br><span class="line">  before_script:</span><br><span class="line">    - docker login -u &quot;$CI_REGISTRY_USER&quot; -p &quot;$CI_REGISTRY_PASSWORD&quot; $CI_REGISTRY</span><br><span class="line">  script:</span><br><span class="line">    - if [ -n &quot;`docker ps -a|grep -w $PROJECT_NAME |awk &#123;&#x27;print $1&#x27;&#125;`&quot; ];</span><br><span class="line">      then docker rm -f $PROJECT_NAME;</span><br><span class="line">      fi</span><br><span class="line">    - docker run --restart always -d --name $PROJECT_NAME -v $LOG_PATH_MAPPING -p $PORT_MAPPING --env JAVA_OPTS=&quot;$JAVA_OPTS&quot; $DEV_IMAGE</span><br><span class="line">  only:</span><br><span class="line">    - web</span><br><span class="line">  tags:</span><br><span class="line">    - $PROJECT_DST</span><br><span class="line">  environment:</span><br><span class="line">    name: dev</span><br><span class="line">    url: https://dev.example.com/demo-service/monitor/health</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="gitlab及gitlab-runner注意事项"><a href="#gitlab及gitlab-runner注意事项" class="headerlink" title="gitlab及gitlab-runner注意事项"></a>gitlab及gitlab-runner注意事项</h3><ol>
<li>gitlab中的一些全局变量是针对项目还是针对项目组的，否则会变量没声明</li>
<li>gitlab-runner中 volumes配置是下载放置的目录(如nginx配置这种)，需要添加上</li>
<li>gitlab可设置自定义变量，在pipeline run的时候传过去，如(dev、stg、prd各环境)</li>
<li>gitlab ci/cd master下面需要有.gitlab-ci.yml，不管用不用</li>
</ol>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>