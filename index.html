<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>linkpwd| | linkpwd's blog 自留地</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><header class="wrapper header"><div class="container blog-title"><a class="title" id="logo" href="/.">linkpwd|</a><span class="subtitle">linkpwd's blog 自留地</span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div><input id="menu" type="checkbox"><div class="container nav-items"><a class="sidebar-nav-item active" href="/">主页</a><a class="sidebar-nav-item" href="/archives">归档</a></div></header><article class="wrapper"><div class="container entries" id="index-main"><div class="post-entry"><div class="post-desc"><div class="post-title"><a href="/2021/12/14/elk-log-config/">ELK日志系统配置优化</a></div><div class="post-content"><h3 id="filebeat的配置信"><a href="#filebeat的配置信" class="headerlink" title="filebeat的配置信"></a>filebeat的配置信</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cat /etc/filebeat/..data/filebeat.yml</span><br><span class="line">filebeat.yml: </span><br><span class="line"></span><br><span class="line">sh-4.2$ more filebeat.yml </span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /logs/*</span><br><span class="line">  <span class="comment">## field字段动态赋值，与k8s中的filebeat容器</span></span><br><span class="line">  fields:</span><br><span class="line">    project: <span class="variable">$&#123;PROJECT&#125;</span></span><br><span class="line">    group: <span class="variable">$&#123;GROUP&#125;</span></span><br><span class="line">    stage: <span class="variable">$&#123;STAGE&#125;</span></span><br><span class="line">    format: <span class="variable">$&#123;FORMAT&#125;</span></span><br><span class="line"></span><br><span class="line">  multiline:</span><br><span class="line">    pattern: <span class="string">&#x27;^\[[^stacktrace]&#x27;</span></span><br><span class="line">    negate: <span class="literal">true</span></span><br><span class="line">    match: after</span><br><span class="line">processors:</span><br><span class="line">  - add_cloud_metadata:</span><br><span class="line">  - add_host_metadata:</span><br><span class="line"></span><br><span class="line">output.redis:</span><br><span class="line">  hosts: xxx.redis.rds.aliyuncs.com</span><br><span class="line">  password: xxxpasswd</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="logstash的配置信息："><a href="#logstash的配置信息：" class="headerlink" title="logstash的配置信息："></a>logstash的配置信息：</h3><p>据说filter对性能有一定的影响，用不着的话可以注释掉</p></div><div class="post-meta"><div class="post-time">2021-12-14</div></div></div></div><div class="post-entry"><div class="post-desc"><div class="post-title"><a href="/2021/12/14/elk-log-performance/">ELK日志系统性能优化</a></div><div class="post-content"><h3 id="一、问题："><a href="#一、问题：" class="headerlink" title="一、问题："></a>一、问题：</h3><p>ELK日志系统延时严重，redis经常是内存使用率100%</p></div><div class="post-meta"><div class="post-time">2021-12-14</div></div></div></div><div class="post-entry"><div class="post-desc"><div class="post-title"><a href="/2021/12/06/websocket/">WebSocket服务部署</a></div><div class="post-content"><h3 id="配置文件，使支持websocket协议"><a href="#配置文件，使支持websocket协议" class="headerlink" title="配置文件，使支持websocket协议"></a>配置文件，使支持websocket协议</h3><p><a target="_blank" rel="noopener" href="https://www.nginx.com/blog/websocket-nginx/">websocket-nginx</a></p></div><div class="post-meta"><div class="post-time">2021-12-06</div></div></div></div><div class="post-entry"><div class="post-desc"><div class="post-title"><a href="/2021/12/06/loki-install-k8s/">k8s环境中loki安装部署</a></div><div class="post-content"><p>ELK这套日志系统相对来说还是太重了，安装部署过程也不简单，消耗的CPU、内存资源也较大。而loki则轻量级，且是根据prometheus思想开发的，消耗资源也很小。以下用它来采集下日志。</p></div><div class="post-meta"><div class="post-time">2021-12-06</div></div></div></div><div class="post-entry"><div class="post-desc"><div class="post-title"><a href="/2021/11/17/public-network/">公网IP地址查询方法</a></div><div class="post-content"><p>查公网ip的一些链接，以前有一些，当然自己也可以使用nginx return,主要内容来自aliyun文档，记录收藏一下</p></div><div class="post-meta"><div class="post-time">2021-11-17</div></div></div></div><div class="post-entry"><div class="post-desc"><div class="post-title"><a href="/2021/11/09/elasticsearch-docker/">elasticsearch单机docker版</a></div><div class="post-content"><h3 id="拉取镜像，设置目录和环境变量并运行"><a href="#拉取镜像，设置目录和环境变量并运行" class="headerlink" title="拉取镜像，设置目录和环境变量并运行"></a>拉取镜像，设置目录和环境变量并运行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 29200:9200 -p 29300:9300 --name elasticsearch --restart=always \</span><br><span class="line">   -e <span class="string">&quot;discovery.type=single-node&quot;</span> \</span><br><span class="line">   -e <span class="string">&quot;cluster.name=elasticsearch&quot;</span> \</span><br><span class="line">   -v /mnt/elasticsearch/plugins:/usr/share/elasticsearch/plugins \</span><br><span class="line">   -v /mnt/elasticsearch/data:/usr/share/elasticsearch/data \</span><br><span class="line">   -d  elastic/elasticsearch:7.10.2</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="需要在配置文件中开启x-pack验证-修改config目录下面的elasticsearch-yml文件，在里面添加如下内容-并重启"><a href="#需要在配置文件中开启x-pack验证-修改config目录下面的elasticsearch-yml文件，在里面添加如下内容-并重启" class="headerlink" title="需要在配置文件中开启x-pack验证, 修改config目录下面的elasticsearch.yml文件，在里面添加如下内容,并重启."></a>需要在配置文件中开启x-pack验证, 修改config目录下面的elasticsearch.yml文件，在里面添加如下内容,并重启.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xpack.security.enabled: <span class="literal">true</span></span><br><span class="line">xpack.license.self_generated.type: basic</span><br><span class="line">xpack.security.transport.ssl.enabled: <span class="literal">true</span></span><br></pre></td></tr></table></figure>


<br/>

<h3 id="执行设置用户名和密码的命令-这里需要为4个用户分别设置密码，elastic-kibana-logstash-system-beats-system"><a href="#执行设置用户名和密码的命令-这里需要为4个用户分别设置密码，elastic-kibana-logstash-system-beats-system" class="headerlink" title="执行设置用户名和密码的命令,这里需要为4个用户分别设置密码，elastic, kibana, logstash_system,beats_system"></a>执行设置用户名和密码的命令,这里需要为4个用户分别设置密码，elastic, kibana, logstash_system,beats_system</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">bin/elasticsearch-setup-passwords interactive</span><br><span class="line">Initiating the setup of passwords <span class="keyword">for</span> reserved users elastic,apm_system,kibana,kibana_system,logstash_system,beats_system,remote_monitoring_user.</span><br><span class="line">You will be prompted to enter passwords as the process progresses.</span><br><span class="line">Please confirm that you would like to <span class="built_in">continue</span> [y/N]y</span><br><span class="line"></span><br><span class="line">Enter password <span class="keyword">for</span> [elastic]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [elastic]: </span><br><span class="line">Enter password <span class="keyword">for</span> [apm_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [apm_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [kibana_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [kibana_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [logstash_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [logstash_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [beats_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [beats_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [remote_monitoring_user]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [remote_monitoring_user]: </span><br><span class="line">Changed password <span class="keyword">for</span> user [apm_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [kibana_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [kibana]</span><br><span class="line">Changed password <span class="keyword">for</span> user [logstash_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [beats_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [remote_monitoring_user]</span><br><span class="line">Changed password <span class="keyword">for</span> user [elastic]</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="修改密码的方式："><a href="#修改密码的方式：" class="headerlink" title="修改密码的方式："></a>修改密码的方式：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&quot;Content-Type:application/json&quot;</span> -XPOST -u elastic <span class="string">&#x27;http://127.0.0.1:9200/_xpack/security/user/elastic/_password&#x27;</span> -d <span class="string">&#x27;&#123; &quot;password&quot; : &quot;mypassword&quot; &#125;&#x27;</span></span><br></pre></td></tr></table></figure>
</div><div class="post-meta"><div class="post-time">2021-11-09</div></div></div></div><div class="post-entry"><div class="post-desc"><div class="post-title"><a href="/2021/10/09/frp/">frp内网穿透</a></div><div class="post-content"><h3 id="下载frp-release的版本，server端linux，-client端windows"><a href="#下载frp-release的版本，server端linux，-client端windows" class="headerlink" title="下载frp release的版本，server端linux， client端windows"></a>下载frp release的版本，server端linux， client端windows</h3><p><a target="_blank" rel="noopener" href="https://github.com/fatedier/frp/releases">frp</a></p></div><div class="post-meta"><div class="post-time">2021-10-09</div></div></div></div><div class="post-entry"><div class="post-desc"><div class="post-title"><a href="/2021/09/29/kibana-monitoring-deny/">kibana Stack Monitoring deny</a></div><div class="post-content"><p>今天点击Stack Monitoring查看ES集群日志性能的时候，发现出错了，于是有此文</p></div><div class="post-meta"><div class="post-time">2021-09-29</div></div></div></div><div class="post-entry"><div class="post-desc"><div class="post-title"><a href="/2021/09/26/docker-summary/">docker的一些总结</a></div><div class="post-content"><h3 id="操作系统基础镜像"><a href="#操作系统基础镜像" class="headerlink" title="操作系统基础镜像"></a>操作系统基础镜像</h3><table>
<thead>
<tr>
<th>名称</th>
<th>大小</th>
<th>包管理</th>
<th>场景</th>
</tr>
</thead>
<tbody><tr>
<td>busybox</td>
<td>1.xMB</td>
<td>apk, lbu</td>
<td>超级简化版嵌入式</td>
</tr>
<tr>
<td>alpine</td>
<td>5.x MB</td>
<td>apk, lbu</td>
<td>Alpine是一个面向安全的、轻量级的Linux系统，基于musl libc和busybox</td>
</tr>
<tr>
<td>ubuntu</td>
<td>70~80 MB</td>
<td>apt-get, dpkg</td>
<td>非常出色的Linux发行版</td>
</tr>
<tr>
<td>debian</td>
<td>120~+/- MB</td>
<td>apt-get, dpkg</td>
<td>非常出色的Linux发行版,很多基于它的发行版</td>
</tr>
<tr>
<td>centos</td>
<td>200+ MB</td>
<td>yum, rpm</td>
<td>CentOS是RedHat的社区版</td>
</tr>
</tbody></table>
<br/>

<h3 id="编程语言基础镜像"><a href="#编程语言基础镜像" class="headerlink" title="编程语言基础镜像"></a>编程语言基础镜像</h3><table>
<thead>
<tr>
<th>名称</th>
<th>tag</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>java</td>
<td>openjdk:11</td>
<td>由于oracle jdk版本，不提供docker官方,可手动下载打docker镜像</td>
</tr>
<tr>
<td>python</td>
<td>3.9.7-alpine3.14</td>
<td>略</td>
</tr>
<tr>
<td>go</td>
<td>1.16.8-alpine3.14</td>
<td>略</td>
</tr>
<tr>
<td>nodejs</td>
<td>14-alpine3.12/16-alpine3.12</td>
<td>略</td>
</tr>
</tbody></table>
<br/>

<h3 id="个人常用工具及应用"><a href="#个人常用工具及应用" class="headerlink" title="个人常用工具及应用"></a>个人常用工具及应用</h3><table>
<thead>
<tr>
<th>名称</th>
<th>tag</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>maven</td>
<td>3.8.2-jdk-8-slim/3.8.2-openjdk-17</td>
<td>略</td>
</tr>
<tr>
<td>jenkins</td>
<td>2.60.3</td>
<td>略</td>
</tr>
<tr>
<td>GitLab</td>
<td>gitlab/gitlab-ce</td>
<td>略</td>
</tr>
<tr>
<td>yearning</td>
<td>2.3.5</td>
<td>略</td>
</tr>
<tr>
<td>mysql</td>
<td>8.0.26</td>
<td>略</td>
</tr>
<tr>
<td>nginx</td>
<td>stable-alpine, 1.20-alpine</td>
<td>略</td>
</tr>
</tbody></table>
<h3 id="alpine的工小具"><a href="#alpine的工小具" class="headerlink" title="alpine的工小具"></a><a target="_blank" rel="noopener" href="https://hub.docker.com/search?q=alpine&type=image">alpine的工小具</a></h3><table>
<thead>
<tr>
<th>名称</th>
<th>用途</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>alpine/k8s</td>
<td>CI/CD相关的时候</td>
<td>Kubernetes toolbox for EKS (kubectl, helm, iam-authenticator, eksctl, etc)</td>
</tr>
<tr>
<td>alpine/git</td>
<td>临时的git command</td>
<td>A simple git container running in alpine linux, especially for tiny linux distro.</td>
</tr>
<tr>
<td>alpine/helm</td>
<td>heam相关</td>
<td>Auto-trigger docker build for kubernetes helm when new release is announced</td>
</tr>
<tr>
<td>alpine/jmeter</td>
<td>压测</td>
<td>略</td>
</tr>
<tr>
<td>alpine/dfimage</td>
<td>解析镜像中的内容，便于重新反写Dockerfile文件</td>
<td>reverse Docker images into Dockerfiles</td>
</tr>
<tr>
<td>alpine/ansible</td>
<td>运维管理工作</td>
<td>略</td>
</tr>
</tbody></table>
<br/>

<h3 id="运行一些常用docker的命令"><a href="#运行一些常用docker的命令" class="headerlink" title="运行一些常用docker的命令"></a>运行一些常用docker的命令</h3><p>mysql server : </p></div><div class="post-meta"><div class="post-time">2021-09-26</div></div></div></div><div class="post-entry"><div class="post-desc"><div class="post-title"><a href="/2021/09/14/gitlab-cicd/">gitlab通过pipeline实现ci/cd</a></div><div class="post-content"><h3 id="运行环境-gitlab-gitlab-runner运行环境"><a href="#运行环境-gitlab-gitlab-runner运行环境" class="headerlink" title="运行环境 gitlab + gitlab runner运行环境"></a>运行环境 gitlab + gitlab runner运行环境</h3><blockquote>
<p>gitlab分gitlab/gitlab-ce, gitlab/gitlab-ee， 社区版本和企业版本<br>系统: CentOS7.9<br>docker: 20.10.8<br>gitlab版本： GitLab Community Edition 14.1.2</p></div><div class="post-meta"><div class="post-time">2021-09-14</div></div></div></div></div></article><div class="wrapper page-navigator-wrapper"><div class="page-navigator"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next »</a></div></div><footer class="footer wrapper"><div class="social"></div><div class="footer-content">© 2021 <a href="/" rel="nofollow">linkpwd|</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/hexo-theme-noise">noise</a>.</div></footer><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>